
- [Подсистема "Рассылки и оповещения клиентам".](#подсистема-рассылки-и-оповещения-клиентам)
  - [Объекты метаданных](#объекты-метаданных)
    - [Общие модули](#общие-модули)
    - [Регламентные задания](#регламентные-задания)
    - [Регистры сведений](#регистры-сведений)
    - [Документы](#документы)
    - [Сниппет](#сниппет)

# Подсистема "Рассылки и оповещения клиентам".

## Объекты метаданных

### Общие модули
- РассылкиИОповещенияКлиентам
- РассылкиИОповещенияКлиентамВызовСервера
- РассылкиИОповещенияКлиентамКлиент
- РассылкиИОповещенияКлиентамПовтИсп

### Регламентные задания

- ФормированиеСообщенийПоОповещениямКлиентов

### Регистры сведений

- ОчередьСобытийДляОповещенийКлиентам

### Документы

- РассылкаКлиентам



### Сниппет

``` bsl

// Обработчик подписки на событие "При записи" регистров сведения и накопления
//  для формирования очереди оповещений клиентов. Выступает маршрутизатором для различных типов источников.
//
// Параметры:
//  Источник  - РегистрСведенийНаборЗаписей, РегистрНакопленияНаборЗаписей - набор записей, данные которого
//                                                                           анализируются при записи.
//  Отказ     - Булево - возможность отказаться от записи набора записей.
//
Процедура ИсточникОповещенияПриЗаписиРегистры(Источник, Отказ) Экспорт
	
	Если Источник.ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	УстановитьПривилегированныйРежим(Истина);
	
	Если ТипЗнч(Источник) = Тип("РегистрНакопленияНаборЗаписей.БонусныеБаллы") Тогда
		
		ОбработатьИзменениеБонусныхБаллов(Источник, "ПриЗаписи");
		
	ИначеЕсли ТипЗнч(Источник) = Тип("РегистрСведенийНаборЗаписей.СостоянияЗаказовКлиентов") Тогда
		
		ОбработатьИзменениеСостоянияЗаказовКлиента(Источник, "ПриЗаписи");
		
	КонецЕсли;
	
	МодификацияКонфигурацииПереопределяемый.ИсточникОповещенияПриЗаписи(Источник, Отказ);
	
КонецПроцедуры


Процедура ЗаписьВОчередьПоТипуСобытия(ТипСобытияОповещения, ИсточникОповещения, Подписчик, ДатаОтправки, ДатаАктуальности)
	
	МассивВидовОповещений = РассылкиИОповещенияКлиентамПовтИсп.ДействующиеВидыОповещенийПоТипуСобытия(ТипСобытияОповещения);
	
	Для Каждого ВидОповещения Из МассивВидовОповещений Цикл
			
			РегистрыСведений.ОчередьСобытийДляОповещенийКлиентам.ВыполнитьЗаписьВРегистр(ВидОповещения,
			                                                                             Подписчик,
			                                                                             ИсточникОповещения,
			                                                                             ДатаОтправки,
			                                                                             ДатаАктуальности);
		
	КонецЦикла;
	
КонецПроцедуры


Функция ТаблицыОтличаются(Таблица1, Таблица2)

	Если Таблица1.Количество() <> Таблица2.Количество() Тогда
		Возврат Истина;
	КонецЕсли;
	
	Если Таблица1.Колонки.Количество() <> Таблица2.Колонки.Количество() Тогда
		Возврат Истина
	КонецЕсли;
	
	Для ИндСтрока = 0 По Таблица1.Количество() - 1 Цикл
		Для ИндКолонка = 0 По Таблица1.Колонки.Количество() - 1 Цикл
		
			Если Таблица1[ИндСтрока][ИндКолонка] <> Таблица2[ИндСтрока][ИндКолонка] Тогда
				Возврат Истина;
			КонецЕсли;
				
		КонецЦикла;
	КонецЦикла;
	
	Возврат Ложь;

КонецФункции


```